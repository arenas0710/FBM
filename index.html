<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#165DFF',
secondary: '#36CFC9',
success: '#52C41A',
warning: '#FAAD14',
danger: '#F5222D',
},
fontFamily: {
inter: ['Inter', 'system-ui', 'sans-serif'],
},
},
}
}
</script>

<style type="text/tailwindcss">
@layer utilities {
.card-shadow { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
.input-focus { @apply focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none; }
.btn-primary { @apply bg-primary text-white hover:bg-primary/90 transition-all px-4 py-2 rounded-lg; }
.btn-secondary { @apply bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 transition-all px-4 py-2 rounded-lg; }
.btn-danger { @apply bg-white border border-danger text-danger hover:bg-danger/10 transition-all px-4 py-2 rounded-lg; }
.tag-pill { @apply bg-primary/10 text-primary px-3 py-1 rounded-full text-sm flex items-center; }
.fade-in { animation: fadeIn 0.3s ease; }
.copy-hover { @apply hover:bg-primary/5 transition-colors cursor-pointer; }
.module-hidden { display: none !important; }
.drag-over { @apply border-primary bg-primary/5; }
.loading-spinner {
border-top-color: theme('colors.primary');
animation: spinner 0.8s linear infinite;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes spinner { to { transform: rotate(360deg); } }
}
</style>

<style>
/* 确保导入模态框优先显示，避免被其他元素遮挡 /
#import-modal { z-index: 100; }
/ 优化表格滚动性能，减少部署后滚动卡顿 /
.overflow-x-auto { will-change: scroll-position; }
/ 禁用文本选择，避免操作时误选导致的卡顿 /
.no-select { user-select: none; -webkit-user-select: none; }
/ 优化按钮点击反馈，避免部署后点击延迟感 */
button { touch-action: manipulation; }
</style>

</head>

<body class="font-inter bg-gray-50 min-h-screen flex flex-col">
<!-- 顶部导航 -->
<header class="bg-white shadow-sm sticky top-0 z-50 no-select">
<div class="container mx-auto px-4 py-3 flex items-center justify-between">
<div class="flex items-center space-x-2">
<i class="fa fa-calculator text-primary text-2xl"></i>
<h1 class="text-xl font-bold text-primary">FBM售价计算器</h1>
</div>

  <!-- 桌面端标签 -->

  &#x3C;div class=&#x22;hidden md:flex items-center space-x-1&#x22;&#x3E;
    &#x3C;button id=&#x22;tab-shipping&#x22; class=&#x22;px-5 py-3 font-medium text-primary border-b-2 border-primary&#x22;&#x3E;&#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#x3C;/button&#x3E;
    &#x3C;button id=&#x22;tab-pricing&#x22; class=&#x22;px-5 py-3 font-medium text-gray-600 border-b-2 border-transparent&#x22;&#x3E;&#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#x3C;/button&#x3E;
  &#x3C;/div&#x3E;

  <!-- 移动端菜单按钮 -->

  &#x3C;button id=&#x22;mobile-menu-btn&#x22; class=&#x22;md:hidden text-gray-600&#x22;&#x3E;
    &#x3C;i class=&#x22;fa fa-bars text-xl&#x22;&#x3E;&#x3C;/i&#x3E;
  &#x3C;/button&#x3E;
&#x3C;/div&#x3E;

<!-- 移动端菜单 -->

&#x3C;div id=&#x22;mobile-menu&#x22; class=&#x22;hidden md:hidden bg-white border-t fade-in&#x22;&#x3E;
  &#x3C;div class=&#x22;container mx-auto px-4 py-2 flex flex-col&#x22;&#x3E;
    &#x3C;button id=&#x22;mobile-tab-shipping&#x22; class=&#x22;py-3 px-4 text-left font-medium text-primary border-l-4 border-primary&#x22;&#x3E;&#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#x3C;/button&#x3E;
    &#x3C;button id=&#x22;mobile-tab-pricing&#x22; class=&#x22;py-3 px-4 text-left font-medium text-gray-600 border-l-4 border-transparent&#x22;&#x3E;&#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#x3C;/button&#x3E;
  &#x3C;/div&#x3E;
&#x3C;/div&#x3E;

</header>

<main class="flex-grow container mx-auto px-4 py-6">
<!-- 运费计算模块 -->
<section id="shipping-module" class="">
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
<!-- 左侧：物流信息管理 -->
<div class="lg:col-span-1 space-y-6">
<div class="bg-white rounded-xl p-5 card-shadow">
<div class="flex justify-between items-center mb-4">
<h2 class="text-lg font-bold">物流信息管理</h2>
<button id="add-logistics-btn" class="btn-primary text-sm flex items-center">
<i class="fa fa-plus mr-1"></i> 添加
</button>
</div>

        <!-- 操作按钮 -->

        &#x3C;div class=&#x22;flex flex-wrap gap-2 mb-4&#x22;&#x3E;
          &#x3C;button id=&#x22;import-logistics-btn&#x22; class=&#x22;btn-secondary text-sm flex items-center&#x22; data-import-type=&#x22;logistics&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-upload mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x5BFC;&#x5165;Excel
          &#x3C;/button&#x3E;
          &#x3C;button id=&#x22;export-logistics-template-btn&#x22; class=&#x22;btn-secondary text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-download mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x5BFC;&#x51FA;&#x6A21;&#x677F;
          &#x3C;/button&#x3E;
          &#x3C;button id=&#x22;delete-selected-logistics-btn&#x22; class=&#x22;btn-danger text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-trash mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x6279;&#x91CF;&#x5220;&#x9664;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;

        <!-- 搜索筛选 -->

        &#x3C;div class=&#x22;flex flex-col sm:flex-row gap-3 mb-4&#x22;&#x3E;
          &#x3C;input type=&#x22;text&#x22; id=&#x22;logistics-search&#x22; placeholder=&#x22;&#x641C;&#x7D22;&#x56FD;&#x5BB6;/&#x6E20;&#x9053;...&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus text-sm&#x22;&#x3E;
          &#x3C;select id=&#x22;logistics-country-filter&#x22; class=&#x22;px-3 py-2 border border-gray-300 rounded-lg input-focus input-focus text-sm&#x22;&#x3E;
            &#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x56FD;&#x5BB6;&#x3C;/option&#x3E;
          &#x3C;/select&#x3E;
        &#x3C;/div&#x3E;

        <!-- 物流表格 -->

        &#x3C;div class=&#x22;overflow-x-auto max-h-[500px] overflow-y-auto&#x22; style=&#x22;overscroll-behavior: contain;&#x22;&#x3E;
          &#x3C;table class=&#x22;min-w-full text-sm&#x22;&#x3E;
            &#x3C;thead&#x3E;
              &#x3C;tr class=&#x22;bg-gray-50 text-left&#x22;&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 w-10&#x22;&#x3E;&#x3C;input type=&#x22;checkbox&#x22; id=&#x22;select-all-logistics&#x22;&#x3E;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x6E20;&#x9053;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x91CD;&#x91CF;&#x8303;&#x56F4;(kg)&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x64CD;&#x4F5C;&#x3C;/th&#x3E;
              &#x3C;/tr&#x3E;
            &#x3C;/thead&#x3E;
            &#x3C;tbody id=&#x22;logistics-table-body&#x22;&#x3E;
              &#x3C;tr&#x3E;&#x3C;td colspan=&#x22;5&#x22; class=&#x22;px-2 py-4 text-center text-gray-500&#x22;&#x3E;&#x6682;&#x65E0;&#x7269;&#x6D41;&#x6570;&#x636E;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;
            &#x3C;/tbody&#x3E;
          &#x3C;/table&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;

    <!-- 右侧：运费计算 -->

    &#x3C;div class=&#x22;lg:col-span-3 space-y-6&#x22;&#x3E;
      &#x3C;!-- &#x8BA1;&#x7B97;&#x8868;&#x5355; --&#x3E;
      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;h2 class=&#x22;text-lg font-bold mb-4&#x22;&#x3E;&#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#x3C;/h2&#x3E;
        &#x3C;form id=&#x22;shipping-calculator-form&#x22; class=&#x22;space-y-4&#x22;&#x3E;
          &#x3C;!-- &#x56FD;&#x5BB6;&#x9009;&#x62E9; --&#x3E;
          &#x3C;div&#x3E;
            &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x56FD;&#x5BB6;/&#x5730;&#x533A; &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E; &#x3C;span class=&#x22;text-xs text-gray-500&#x22;&#x3E;(&#x8F93;&#x5165;&#x540E;&#x6309;&#x56DE;&#x8F66;&#x6DFB;&#x52A0;)&#x3C;/span&#x3E;&#x3C;/label&#x3E;
            &#x3C;div class=&#x22;relative&#x22;&#x3E;
              &#x3C;input type=&#x22;text&#x22; id=&#x22;shipping-country-input&#x22; placeholder=&#x22;&#x8F93;&#x5165;&#x56FD;&#x5BB6;&#x5E76;&#x6309;&#x56DE;&#x8F66;&#x6DFB;&#x52A0;...&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;div id=&#x22;shipping-country-dropdown&#x22; class=&#x22;absolute z-10 top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg hidden max-h-40 overflow-y-auto&#x22;&#x3E;&#x3C;/div&#x3E;
            &#x3C;/div&#x3E;
            &#x3C;div id=&#x22;selected-shipping-countries&#x22; class=&#x22;flex flex-wrap gap-2 mt-2&#x22;&#x3E;&#x3C;/div&#x3E;
          &#x3C;/div&#x3E;

          <!-- 尺寸信息和重量参数 - 整合为一行 -->

          &#x3C;div class=&#x22;grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4&#x22;&#x3E;
            &#x3C;div&#x3E;
              &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x957F; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
              &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;length&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
            &#x3C;/div&#x3E;
            &#x3C;div&#x3E;
              &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x5BBD; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
              &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;width&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
            &#x3C;/div&#x3E;
            &#x3C;div&#x3E;
              &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x9AD8; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
              &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;height&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
            &#x3C;/div&#x3E;
            &#x3C;div&#x3E;
              &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x4F53;&#x79EF;&#x53C2;&#x6570;&#x3C;/label&#x3E;
              &#x3C;input type=&#x22;number&#x22; name=&#x22;volumeParam&#x22; value=&#x22;8000&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
            &#x3C;/div&#x3E;
            &#x3C;div&#x3E;
              &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x5305;&#x88F9;&#x91CD;&#x91CF; (kg) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
              &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;weight&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
            &#x3C;/div&#x3E;
          &#x3C;/div&#x3E;

          <!-- 操作按钮：计算 + 清除 -->

          &#x3C;div class=&#x22;flex justify-end gap-3&#x22;&#x3E;
            &#x3C;button type=&#x22;button&#x22; id=&#x22;clear-shipping-data-btn&#x22; class=&#x22;btn-secondary flex items-center&#x22;&#x3E;
              &#x3C;i class=&#x22;fa fa-trash mr-2&#x22;&#x3E;&#x3C;/i&#x3E; &#x6E05;&#x9664;&#x6570;&#x636E;
            &#x3C;/button&#x3E;
            &#x3C;button type=&#x22;submit&#x22; class=&#x22;btn-primary flex items-center&#x22;&#x3E;
              &#x3C;i class=&#x22;fa fa-calculator mr-2&#x22;&#x3E;&#x3C;/i&#x3E; &#x8BA1;&#x7B97;&#x8FD0;&#x8D39;
            &#x3C;/button&#x3E;
          &#x3C;/div&#x3E;
        &#x3C;/form&#x3E;
      &#x3C;/div&#x3E;

      <!-- 计算结果 -->

      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;div class=&#x22;flex flex-col md:flex-row md:items-center justify-between mb-4 gap-3&#x22;&#x3E;
          &#x3C;h2 class=&#x22;text-lg font-bold&#x22;&#x3E;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3C;/h2&#x3E;
          &#x3C;div class=&#x22;flex flex-wrap gap-2&#x22;&#x3E;
            &#x3C;select id=&#x22;result-country-filter&#x22; class=&#x22;px-3 py-2 border border-gray-300 rounded-lg input-focus text-sm&#x22;&#x3E;
              &#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x56FD;&#x5BB6;&#x3C;/option&#x3E;
            &#x3C;/select&#x3E;
            &#x3C;select id=&#x22;result-channel-filter&#x22; class=&#x22;px-3 py-2 border border-gray-300 rounded-lg input-focus text-sm&#x22;&#x3E;
              &#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x6E20;&#x9053;&#x3C;/option&#x3E;
            &#x3C;/select&#x3E;
            &#x3C;button id=&#x22;reset-filters-btn&#x22; class=&#x22;btn-secondary text-sm&#x22;&#x3E;&#x91CD;&#x7F6E;&#x7B5B;&#x9009;&#x3C;/button&#x3E;
          &#x3C;/div&#x3E;
        &#x3C;/div&#x3E;

        <!-- 空状态 -->

        &#x3C;div id=&#x22;shipping-result-empty&#x22; class=&#x22;py-10 text-center text-gray-500&#x22;&#x3E;
          &#x3C;i class=&#x22;fa fa-box text-4xl mb-3 opacity-30&#x22;&#x3E;&#x3C;/i&#x3E;
          &#x3C;p&#x3E;&#x8BF7;&#x8F93;&#x5165;&#x5305;&#x88F9;&#x4FE1;&#x606F;&#x5E76;&#x8BA1;&#x7B97;&#x8FD0;&#x8D39;&#x3C;/p&#x3E;
        &#x3C;/div&#x3E;

        <!-- 结果列表 -->

        &#x3C;div id=&#x22;shipping-result&#x22; class=&#x22;hidden&#x22;&#x3E;
          &#x3C;div class=&#x22;overflow-x-auto&#x22; style=&#x22;overscroll-behavior: contain;&#x22;&#x3E;
            &#x3C;table class=&#x22;min-w-full text-sm&#x22;&#x3E;
              &#x3C;thead&#x3E;
                &#x3C;tr class=&#x22;bg-gray-50 text-left&#x22;&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x3C;/th&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x6E20;&#x9053;&#x3C;/th&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x4F53;&#x79EF;&#x91CD; (kg)&#x3C;/th&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x8BA1;&#x8D39;&#x91CD;&#x91CF; (kg)&#x3C;/th&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x8FD0;&#x8D39; (RMB)&#x3C;/th&#x3E;
                  &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x5907;&#x6CE8;&#x3C;/th&#x3E;
                &#x3C;/tr&#x3E;
              &#x3C;/thead&#x3E;
              &#x3C;tbody id=&#x22;shipping-result-body&#x22;&#x3E;&#x3C;/tbody&#x3E;
            &#x3C;/table&#x3E;
          &#x3C;/div&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;
  &#x3C;/div&#x3E;
&#x3C;/section&#x3E;

<!-- 售价计算模块 -->

&#x3C;section id=&#x22;pricing-module&#x22; class=&#x22;module-hidden&#x22;&#x3E;
  &#x3C;div class=&#x22;grid grid-cols-1 lg:grid-cols-4 gap-6&#x22;&#x3E;
    &#x3C;!-- &#x5DE6;&#x4FA7;&#xFF1A;&#x4E9A;&#x9A6C;&#x900A;&#x4F63;&#x91D1;&#x7BA1;&#x7406; --&#x3E;
    &#x3C;div class=&#x22;lg:col-span-1 space-y-6&#x22;&#x3E;
      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;div class=&#x22;flex justify-between items-center mb-4&#x22;&#x3E;
          &#x3C;h2 class=&#x22;text-lg font-bold&#x22;&#x3E;&#x4E9A;&#x9A6C;&#x900A;&#x4F63;&#x91D1;&#x7BA1;&#x7406;&#x3C;/h2&#x3E;
          &#x3C;button id=&#x22;add-commission-btn&#x22; class=&#x22;btn-primary text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-plus mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x6DFB;&#x52A0;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;

        <!-- 操作按钮 -->

        &#x3C;div class=&#x22;flex flex-wrap gap-2 mb-4&#x22;&#x3E;
          &#x3C;button id=&#x22;import-commission-btn&#x22; class=&#x22;btn-secondary text-sm flex items-center&#x22; data-import-type=&#x22;commission&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-upload mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x5BFC;&#x5165;Excel
          &#x3C;/button&#x3E;
          &#x3C;button id=&#x22;export-commission-template-btn&#x22; class=&#x22;btn-secondary text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-download mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x5BFC;&#x51FA;&#x6A21;&#x677F;
          &#x3C;/button&#x3E;
          &#x3C;button id=&#x22;delete-selected-commission-btn&#x22; class=&#x22;btn-danger text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-trash mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x6279;&#x91CF;&#x5220;&#x9664;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;

        <!-- 搜索框 -->

        &#x3C;div class=&#x22;mb-4&#x22;&#x3E;
          &#x3C;input type=&#x22;text&#x22; id=&#x22;commission-search&#x22; placeholder=&#x22;&#x641C;&#x7D22;&#x56FD;&#x5BB6;/&#x5730;&#x533A;...&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus text-sm&#x22;&#x3E;
        &#x3C;/div&#x3E;

        <!-- 佣金表格 -->

        &#x3C;div class=&#x22;overflow-x-auto max-h-[500px] overflow-y-auto&#x22; style=&#x22;overscroll-behavior: contain;&#x22;&#x3E;
          &#x3C;table class=&#x22;min-w-full text-sm&#x22;&#x3E;
            &#x3C;thead&#x3E;
              &#x3C;tr class=&#x22;bg-gray-50 text-left&#x22;&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 w-10&#x22;&#x3E;&#x3C;input type=&#x22;checkbox&#x22; id=&#x22;select-all-commission&#x22;&#x3E;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x4F63;&#x91D1; (%)&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x5E02;&#x573A;&#x7A0E; (%)&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x6C47;&#x7387;&#x3C;/th&#x3E;
                &#x3C;th class=&#x22;px-2 py-2 font-medium text-gray-600&#x22;&#x3E;&#x64CD;&#x4F5C;&#x3C;/th&#x3E;
              &#x3C;/tr&#x3E;
            &#x3C;/thead&#x3E;
            &#x3C;tbody id=&#x22;commission-table-body&#x22;&#x3E;
              &#x3C;tr&#x3E;&#x3C;td colspan=&#x22;6&#x22; class=&#x22;px-2 py-4 text-center text-gray-500&#x22;&#x3E;&#x6682;&#x65E0;&#x4F63;&#x91D1;&#x6570;&#x636E;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;
            &#x3C;/tbody&#x3E;
          &#x3C;/table&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;

    <!-- 右侧：售价计算 -->

    &#x3C;div class=&#x22;lg:col-span-3 space-y-6&#x22;&#x3E;
      &#x3C;!-- &#x56FD;&#x5BB6;&#x9009;&#x62E9; --&#x3E;
      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;h2 class=&#x22;text-lg font-bold mb-4&#x22;&#x3E;&#x9009;&#x62E9;&#x76EE;&#x6807;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x3C;/h2&#x3E;
        &#x3C;div class=&#x22;relative&#x22;&#x3E;
          &#x3C;input type=&#x22;text&#x22; id=&#x22;pricing-country-input&#x22; placeholder=&#x22;&#x8F93;&#x5165;&#x56FD;&#x5BB6;&#x5E76;&#x6309;&#x56DE;&#x8F66;&#x6DFB;&#x52A0;...&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
          &#x3C;div id=&#x22;pricing-country-dropdown&#x22; class=&#x22;absolute z-10 top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg hidden max-h-40 overflow-y-auto&#x22;&#x3E;&#x3C;/div&#x3E;
        &#x3C;/div&#x3E;
        &#x3C;div id=&#x22;selected-pricing-countries&#x22; class=&#x22;flex flex-wrap gap-2 mt-2&#x22;&#x3E;&#x3C;/div&#x3E;
      &#x3C;/div&#x3E;

      <!-- 自定义运费模块 -->

      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;h2 class=&#x22;text-lg font-bold mb-4&#x22;&#x3E;&#x81EA;&#x5B9A;&#x4E49;&#x8FD0;&#x8D39;&#x3C;/h2&#x3E;
        &#x3C;div&#x3E;
          &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x81EA;&#x5B9A;&#x4E49;&#x8FD0;&#x8D39; (RMB)&#x3C;/label&#x3E;
          &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; id=&#x22;custom-shipping-fee&#x22; value=&#x22;0&#x22; min=&#x22;0&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
          &#x3C;p class=&#x22;text-xs text-gray-500 mt-1&#x22;&#x3E;&#x82E5;&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;&#x5219;&#x6309;&#x7CFB;&#x7EDF;&#x8BA1;&#x7B97;&#x7684;&#x8FD0;&#x8D39;&#x4E3A;&#x51C6;&#xFF1B;&#x82E5;&#x8BBE;&#x7F6E;&#x5927;&#x4E8E;0&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x6B64;&#x8FD0;&#x8D39;&#x503C;&#x3C;/p&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;

      <!-- 包裹信息 -->

      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;div class=&#x22;flex justify-between items-center mb-4&#x22;&#x3E;
          &#x3C;h2 class=&#x22;text-lg font-bold&#x22;&#x3E;&#x5305;&#x88F9;&#x4FE1;&#x606F;&#x3C;/h2&#x3E;
          &#x3C;button id=&#x22;clear-all-packages-btn&#x22; class=&#x22;btn-danger text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-trash mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x5168;&#x90E8;&#x6E05;&#x9664;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;

        <!-- 包裹表单容器 -->

        &#x3C;div id=&#x22;packages-container&#x22;&#x3E;
          &#x3C;!-- &#x521D;&#x59CB;&#x5305;&#x88F9;&#x8868;&#x5355; - &#x4E00;&#x884C;&#x5E03;&#x5C40; --&#x3E;
          &#x3C;div class=&#x22;package-form border border-gray-200 rounded-lg p-4 mb-4 relative&#x22;&#x3E;
            &#x3C;button class=&#x22;absolute -top-3 -right-3 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center text-xs delete-package-btn&#x22;&#x3E;&#xD7;&#x3C;/button&#x3E;

            <!-- 一行布局：所有输入字段 -->

            &#x3C;div class=&#x22;grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4&#x22;&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x957F; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;length&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x5BBD; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;width&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x9AD8; (cm) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;height&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x5305;&#x88F9;&#x91CD;&#x91CF; (kg) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;weight&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x91C7;&#x8D2D;&#x6210;&#x672C; (RMB) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;cost&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
              &#x3C;div&#x3E;
                &#x3C;label class=&#x22;block text-sm font-medium text-gray-700 mb-1&#x22;&#x3E;&#x5229;&#x6DA6;&#x7387; (%) &#x3C;span class=&#x22;text-danger&#x22;&#x3E;*&#x3C;/span&#x3E;&#x3C;/label&#x3E;
                &#x3C;input type=&#x22;number&#x22; step=&#x22;0.01&#x22; name=&#x22;profitMargin&#x22; required=&#x22;&#x22; class=&#x22;w-full px-3 py-2 border border-gray-300 rounded-lg input-focus&#x22;&#x3E;
              &#x3C;/div&#x3E;
            &#x3C;/div&#x3E;
          &#x3C;/div&#x3E;
        &#x3C;/div&#x3E;

        <!-- 操作按钮：添加包裹 + 计算售价 -->

        &#x3C;div class=&#x22;flex justify-between mt-4&#x22;&#x3E;
          &#x3C;button id=&#x22;add-package-btn&#x22; class=&#x22;btn-secondary text-sm flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-plus mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x6DFB;&#x52A0;&#x5305;&#x88F9;
          &#x3C;/button&#x3E;
          &#x3C;button id=&#x22;calculate-pricing-btn&#x22; class=&#x22;btn-primary flex items-center&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-calculator mr-2&#x22;&#x3E;&#x3C;/i&#x3E; &#x8BA1;&#x7B97;&#x552E;&#x4EF7;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;

      <!-- 售价结果 -->

      &#x3C;div class=&#x22;bg-white rounded-xl p-5 card-shadow&#x22;&#x3E;
        &#x3C;h2 class=&#x22;text-lg font-bold mb-4&#x22;&#x3E;&#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3C;/h2&#x3E;
        &#x3C;div id=&#x22;pricing-result-empty&#x22; class=&#x22;py-10 text-center text-gray-500&#x22;&#x3E;
          &#x3C;i class=&#x22;fa fa-tags text-4xl mb-3 opacity-30&#x22;&#x3E;&#x3C;/i&#x3E;
          &#x3C;p&#x3E;&#x8BF7;&#x6DFB;&#x52A0;&#x5305;&#x88F9;&#x4FE1;&#x606F;&#x548C;&#x76EE;&#x6807;&#x56FD;&#x5BB6;&#x5E76;&#x8BA1;&#x7B97;&#x552E;&#x4EF7;&#x3C;/p&#x3E;
        &#x3C;/div&#x3E;
        &#x3C;!-- &#x552E;&#x4EF7;&#x7ED3;&#x679C;&#x8868;&#x683C; --&#x3E;
        &#x3C;div id=&#x22;pricing-result&#x22; class=&#x22;hidden&#x22;&#x3E;
          &#x3C;div class=&#x22;space-y-6&#x22; id=&#x22;pricing-result-container&#x22;&#x3E;
            &#x3C;!-- &#x56FD;&#x5BB6;&#x7ED3;&#x679C;&#x5361;&#x7247;&#x52A8;&#x6001;&#x751F;&#x6210; --&#x3E;
          &#x3C;/div&#x3E;
        &#x3C;/div&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;
  &#x3C;/div&#x3E;
&#x3C;/section&#x3E;

</main>

<div id="logistics-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center no-select">
<div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 fade-in">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold" id="logistics-modal-title">添加物流信息</h3>
<button id="close-logistics-modal" class="text-gray-500 hover:text-gray-700"><i class="fa fa-times"></i></button>
</div>
<form id="logistics-form">
<input type="hidden" id="logistics-id">
<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">国家/地区 <span class="text-danger"></span></label>
<input type="text" id="logistics-country" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">物流渠道 <span class="text-danger"></span></label>
<input type="text" id="logistics-channel" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div class="grid grid-cols-2 gap-3 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">起始重量(kg) <span class="text-danger"></span></label>
<input type="number" step="0.001" id="logistics-start-weight" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">结束重量(kg) <span class="text-danger"></span></label>
<input type="number" step="0.01" id="logistics-end-weight" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
</div>
<div class="grid grid-cols-2 gap-3 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">每kg费用 <span class="text-danger"></span></label>
<input type="number" step="0.01" id="logistics-cost-per-kg" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">挂号费 <span class="text-danger"></span></label>
<input type="number" step="0.01" id="logistics-registration-fee" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
</div>
<div class="flex justify-end gap-2 mt-6">
<button type="button" id="cancel-logistics-btn" class="btn-secondary">取消</button>
<button type="submit" class="btn-primary">保存</button>
</div>
</form>
</div>
</div>

<div id="commission-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center no-select">
<div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 fade-in">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold" id="commission-modal-title">添加亚马逊佣金</h3>
<button id="close-commission-modal" class="text-gray-500 hover:text-gray-700"><i class="fa fa-times"></i></button>
</div>
<form id="commission-form">
<input type="hidden" id="commission-id">
<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">国家/地区 <span class="text-danger"></span></label>
<input type="text" id="commission-country" required="" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div class="grid grid-cols-2 gap-3 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">佣金 (%) <span class="text-danger"></span></label>
<input type="number" step="0.01" id="commission-rate" required="" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">市场税 (%) <span class="text-danger"></span></label>
<input type="number" step="0.01" id="market-tax" required="" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
</div>
</div>
<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">汇率 <span class="text-danger"></span></label>
<input type="number" step="0.0001" id="exchange-rate" required="" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
<p class="text-xs text-gray-500 mt-1">1当地货币可兑换的人民币数量（如：1美元=9.17人民币，汇率填9.17）</p>
</div>
<div class="flex justify-end gap-2 mt-6">
<button type="button" id="cancel-commission-btn" class="btn-secondary">取消</button>
<button type="submit" class="btn-primary">保存</button>
</div>
</form>
</div>
</div>

<div id="import-modal" class="fixed inset-0 bg-black/50 z-100 hidden items-center justify-center no-select">
<div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 fade-in" style="will-change: transform;">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold" id="import-modal-title">导入数据</h3>
<button id="close-import-modal" class="text-gray-500 hover:text-gray-700"><i class="fa fa-times"></i></button>
</div>

  <!-- 导入处理状态（优化DOM结构，减少重绘） -->

  &#x3C;div id=&#x22;import-loading&#x22; class=&#x22;hidden mb-4&#x22;&#x3E;
    &#x3C;div class=&#x22;flex items-center justify-center py-6&#x22;&#x3E;
      &#x3C;div class=&#x22;w-10 h-10 rounded-full border-4 border-gray-200 loading-spinner&#x22;&#x3E;&#x3C;/div&#x3E;
      &#x3C;div class=&#x22;ml-3&#x22;&#x3E;
        &#x3C;p class=&#x22;text-gray-700&#x22;&#x3E;&#x6B63;&#x5728;&#x5904;&#x7406;...&#x3C;/p&#x3E;
        &#x3C;p id=&#x22;import-progress&#x22; class=&#x22;text-sm text-gray-500&#x22;&#x3E;0%&#x3C;/p&#x3E;
      &#x3C;/div&#x3E;
    &#x3C;/div&#x3E;
  &#x3C;/div&#x3E;

  <!-- 导入错误提示（优化显示逻辑） -->

  &#x3C;div id=&#x22;import-error&#x22; class=&#x22;hidden mb-4 p-3 bg-danger/10 text-danger rounded-lg text-sm&#x22;&#x3E;&#x3C;/div&#x3E;

  <!-- 导入区域（优化拖拽响应） -->

  &#x3C;div id=&#x22;import-upload-area&#x22;&#x3E;
    &#x3C;p class=&#x22;text-sm text-gray-600 mb-3&#x22;&#x3E;&#x8BF7;&#x9009;&#x62E9;xls&#x6216;xlsx&#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#xFF08;&#x6700;&#x5927;10MB&#xFF09;&#x3C;/p&#x3E;
    &#x3C;input type=&#x22;file&#x22; id=&#x22;import-file&#x22; accept=&#x22;.xls,.xlsx&#x22; class=&#x22;hidden&#x22; style=&#x22;touch-action: manipulation;&#x22;&#x3E;
    &#x3C;label for=&#x22;import-file&#x22; id=&#x22;import-file-label&#x22; class=&#x22;block border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 transition-all&#x22;&#x3E;
      &#x3C;i class=&#x22;fa fa-file-excel-o text-3xl text-success mb-2&#x22;&#x3E;&#x3C;/i&#x3E;
      &#x3C;p class=&#x22;text-sm text-gray-600&#x22;&#x3E;&#x70B9;&#x51FB;&#x6216;&#x62D6;&#x62FD;&#x6587;&#x4EF6;&#x5230;&#x6B64;&#x5904;&#x3C;/p&#x3E;
    &#x3C;/label&#x3E;
    &#x3C;div id=&#x22;import-file-name&#x22; class=&#x22;mt-2 text-sm text-gray-500 hidden&#x22;&#x3E;&#x3C;/div&#x3E;
  &#x3C;/div&#x3E;

  &#x3C;div class=&#x22;flex justify-end gap-2&#x22;&#x3E;
    &#x3C;button id=&#x22;cancel-import-btn&#x22; class=&#x22;btn-secondary&#x22;&#x3E;&#x53D6;&#x6D88;&#x3C;/button&#x3E;
    &#x3C;button id=&#x22;confirm-import-btn&#x22; class=&#x22;btn-primary&#x22;&#x3E;&#x5BFC;&#x5165;&#x3C;/button&#x3E;
  &#x3C;/div&#x3E;
&#x3C;/div&#x3E;

</div>

<script>
// 全局错误处理（添加部署环境日志）
window.addEventListener('error', function(e) {
console.error('部署环境错误:', e);
// 若为XLSX库加载失败，提供备用提示
if (e.message.includes('XLSX is not defined')) {
alert('Excel处理库加载失败，请刷新页面重试（若多次失败，请检查网络连接）');
}
});

// &#x7B49;&#x5F85;DOM&#x5B8C;&#x5168;&#x52A0;&#x8F7D;&#xFF08;&#x4F18;&#x5316;&#x52A0;&#x8F7D;&#x65F6;&#x673A;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;DOM&#x672A;&#x5C31;&#x7EEA;&#xFF09;
document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() {
  try {
    // &#x9A8C;&#x8BC1;&#x5173;&#x952E;&#x4F9D;&#x8D56;&#x662F;&#x5426;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#xFF08;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x5FC5;&#x5907;&#xFF09;
    if (typeof XLSX === &#x27;undefined&#x27;) {
      throw new Error(&#x27;Excel&#x5904;&#x7406;&#x5E93;&#x672A;&#x52A0;&#x8F7D;&#xFF0C;&#x8BF7;&#x68C0;&#x67E5;CDN&#x94FE;&#x63A5;&#x27;);
    }
    initApp();
  } catch (e) {
    console.error(&#x27;&#x521D;&#x59CB;&#x5316;&#x9519;&#x8BEF;:&#x27;, e);
    alert(&#x27;&#x8BA1;&#x7B97;&#x5668;&#x521D;&#x59CB;&#x5316;&#x5931;&#x8D25;&#xFF1A;&#x27; + e.message + &#x27;&#xFF08;&#x8BF7;&#x5237;&#x65B0;&#x9875;&#x9762;&#x91CD;&#x8BD5;&#xFF09;&#x27;);
  }
});

function initApp() {
  // &#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#xFF08;&#x4F18;&#x5316;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x8BFB;&#x5199;&#xFF0C;&#x51CF;&#x5C11;&#x90E8;&#x7F72;&#x540E;IO&#x963B;&#x585E;&#xFF09;
  initializeData();
  
  // &#x6E32;&#x67D3;&#x521D;&#x59CB;&#x754C;&#x9762;&#xFF08;&#x5206;&#x6279;&#x6B21;&#x6E32;&#x67D3;&#xFF0C;&#x907F;&#x514D;&#x4E3B;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF09;
  setTimeout(renderInitialUI, 0);
  
  // &#x7ED1;&#x5B9A;&#x4E8B;&#x4EF6;&#xFF08;&#x5EF6;&#x8FDF;&#x7ED1;&#x5B9A;&#xFF0C;&#x4F18;&#x5148;&#x4FDD;&#x8BC1;&#x754C;&#x9762;&#x6E32;&#x67D3;&#xFF09;
  setTimeout(bindEventsWithDelegation, 100);
}

// &#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x4F18;&#x5316;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x64CD;&#x4F5C;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x9891;&#x7E41;&#x8BFB;&#x5199;&#xFF09;
function initializeData() {
  // &#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#xFF08;&#x6DFB;&#x52A0;&#x9519;&#x8BEF;&#x6355;&#x83B7;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x5B58;&#x50A8;&#x6743;&#x9650;&#x95EE;&#x9898;&#xFF09;
  window.DataStore = {
    get(key) {
      try {
        // &#x90E8;&#x7F72;&#x73AF;&#x5883;&#x53EF;&#x80FD;&#x9650;&#x5236;localStorage&#xFF0C;&#x6DFB;&#x52A0;&#x964D;&#x7EA7;&#x5904;&#x7406;
        if (!window.localStorage) return [];
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.error(&#x27;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x6570;&#x636E;&#x5931;&#x8D25;&#xFF08;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#xFF09;:&#x27;, e);
        return [];
      }
    },
    set(key, data) {
      try {
        if (!window.localStorage) return;
        localStorage.setItem(key, JSON.stringify(data));
      } catch (e) {
        console.error(&#x27;&#x4FDD;&#x5B58;&#x672C;&#x5730;&#x6570;&#x636E;&#x5931;&#x8D25;&#xFF08;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#xFF09;:&#x27;, e);
      }
    }
  };

  // &#x5E94;&#x7528;&#x72B6;&#x6001;&#xFF08;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x907F;&#x514D;&#x5927;&#x6570;&#x636E;&#x91CF;&#x64CD;&#x4F5C;&#xFF09;
  window.appState = {
    logistics: DataStore.get(&#x27;fbm_logistics&#x27;),
    commissions: DataStore.get(&#x27;fbm_commissions&#x27;),
    selectedShippingCountries: [],
    selectedPricingCountries: [],
    shippingResults: [],
    pricingResults: {}
  };
  
  // &#x8D27;&#x5E01;&#x56FD;&#x5BB6;&#x6620;&#x5C04;&#xFF08;&#x9759;&#x6001;&#x6570;&#x636E;&#x5185;&#x8054;&#xFF0C;&#x907F;&#x514D;&#x5916;&#x90E8;&#x4F9D;&#x8D56;&#xFF09;
  window.currencyCountries = {
    gbp: [&#x27;&#x82F1;&#x56FD;&#x27;],
    eur: [&#x27;&#x7231;&#x5C14;&#x5170;&#x27;, &#x27;&#x5FB7;&#x56FD;&#x27;, &#x27;&#x6CD5;&#x56FD;&#x27;, &#x27;&#x610F;&#x5927;&#x5229;&#x27;, &#x27;&#x8377;&#x5170;&#x27;, &#x27;&#x6BD4;&#x5229;&#x65F6;&#x27;, &#x27;&#x5362;&#x68EE;&#x5821;&#x27;, &#x27;&#x897F;&#x73ED;&#x7259;&#x27;, &#x27;&#x8461;&#x8404;&#x7259;&#x27;, &#x27;&#x5965;&#x5730;&#x5229;&#x27;, &#x27;&#x82AC;&#x5170;&#x27;, &#x27;&#x7ACB;&#x9676;&#x5B9B;&#x27;, &#x27;&#x62C9;&#x8131;&#x7EF4;&#x4E9A;&#x27;, &#x27;&#x7231;&#x6C99;&#x5C3C;&#x4E9A;&#x27;, &#x27;&#x65AF;&#x6D1B;&#x4F10;&#x514B;&#x27;, &#x27;&#x65AF;&#x6D1B;&#x6587;&#x5C3C;&#x4E9A;&#x27;, &#x27;&#x5E0C;&#x814A;&#x27;, &#x27;&#x9A6C;&#x8033;&#x4ED6;&#x27;, &#x27;&#x585E;&#x6D66;&#x8DEF;&#x65AF;&#x27;, &#x27;&#x514B;&#x7F57;&#x5730;&#x4E9A;&#x27;]
  };
}

// &#x5DE5;&#x5177;&#x51FD;&#x6570;&#xFF08;&#x4F18;&#x5316;&#x6027;&#x80FD;&#xFF0C;&#x51CF;&#x5C11;&#x90E8;&#x7F72;&#x540E;&#x8BA1;&#x7B97;&#x8017;&#x65F6;&#xFF09;
function generateId() {
  // &#x7B80;&#x5316;ID&#x751F;&#x6210;&#xFF0C;&#x51CF;&#x5C11;&#x90E8;&#x7F72;&#x540E;&#x8BA1;&#x7B97;&#x91CF;
  return Date.now().toString(36).slice(-8);
}

function exportExcel(headers, data, filename) {
  try {
    // &#x4F18;&#x5316;Excel&#x5BFC;&#x51FA;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x5185;&#x5B58;&#x6EA2;&#x51FA;
    if (data.length &#x3E; 1000) {
      alert(&#x27;&#x5355;&#x6B21;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#x4E0D;&#x8D85;&#x8FC7;1000&#x6761;&#xFF0C;&#x907F;&#x514D;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x27;);
      data = data.slice(0, 1000);
    }
    const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, &#x22;&#x6570;&#x636E;&#x22;);
    // &#x4F18;&#x5316;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x4E0B;&#x8F7D;&#x963B;&#x585E;
    setTimeout(() =&#x3E; XLSX.writeFile(wb, filename), 100);
  } catch (e) {
    console.error(&#x27;&#x5BFC;&#x51FA;Excel&#x5931;&#x8D25;:&#x27;, e);
    alert(&#x27;&#x5BFC;&#x51FA;&#x5931;&#x8D25;&#xFF1A;&#x27; + e.message);
  }
}

// &#x8D27;&#x5E01;&#x56FD;&#x5BB6;&#x5224;&#x65AD;&#xFF08;&#x7B80;&#x5316;&#x903B;&#x8F91;&#xFF0C;&#x51CF;&#x5C11;&#x8BA1;&#x7B97;&#xFF09;
function isGbpCountry(country) {
  return window.currencyCountries.gbp.includes(country);
}
function isEurCountry(country) {
  return window.currencyCountries.eur.includes(country);
}

// &#x6E32;&#x67D3;&#x51FD;&#x6570;&#xFF08;&#x5206;&#x6279;&#x6B21;&#x6E32;&#x67D3;&#xFF0C;&#x4F18;&#x5316;&#x90E8;&#x7F72;&#x540E;UI&#x54CD;&#x5E94;&#xFF09;
function renderInitialUI() {
  // &#x5206;&#x6279;&#x6B21;&#x6E32;&#x67D3;&#x8868;&#x683C;&#xFF0C;&#x907F;&#x514D;&#x4E3B;&#x7EBF;&#x7A0B;&#x963B;&#x585E;
  setTimeout(renderLogisticsTable, 0);
  setTimeout(renderCommissionTable, 100);
  setTimeout(renderSelectedShippingCountries, 200);
  setTimeout(renderSelectedPricingCountries, 300);
}

// &#x7269;&#x6D41;&#x8868;&#x683C;&#x6E32;&#x67D3;&#xFF08;&#x4F18;&#x5316;DOM&#x64CD;&#x4F5C;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x7ED8;&#xFF09;
function renderLogisticsTable() {
  const tableBody = document.getElementById(&#x27;logistics-table-body&#x27;);
  const searchVal = document.getElementById(&#x27;logistics-search&#x27;).value.toLowerCase();
  const countryFilter = document.getElementById(&#x27;logistics-country-filter&#x27;).value;
  
  // &#x4F18;&#x5316;&#x7B5B;&#x9009;&#x903B;&#x8F91;&#xFF0C;&#x51CF;&#x5C11;&#x5FAA;&#x73AF;&#x6B21;&#x6570;
  const filtered = appState.logistics.filter(item =&#x3E; {
    const matchSearch = item.country.toLowerCase().includes(searchVal) || item.channel.toLowerCase().includes(searchVal);
    const matchCountry = !countryFilter || item.country === countryFilter;
    return matchSearch &#x26;&#x26; matchCountry;
  });
  
  if (filtered.length === 0) {
    tableBody.innerHTML = &#x27;&#x3C;tr&#x3E;&#x3C;td colspan=&#x22;5&#x22; class=&#x22;px-2 py-4 text-center text-gray-500&#x22;&#x3E;&#x6682;&#x65E0;&#x7269;&#x6D41;&#x6570;&#x636E;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;;
    return;
  }
  
  // &#x4F18;&#x5316;DOM&#x62FC;&#x63A5;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x7ED8;&#x6B21;&#x6570;
  let html = &#x27;&#x27;;
  filtered.forEach(item =&#x3E; {
    html += &#x60;
      &#x3C;tr class=&#x22;border-b border-gray-100 hover:bg-gray-50&#x22;&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;&#x3C;input type=&#x22;checkbox&#x22; class=&#x22;logistics-checkbox&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${item.country}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${item.channel}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${item.startWeight}-${item.endWeight}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;
          &#x3C;button class=&#x22;text-primary mr-2 edit-logistics&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;i class=&#x22;fa fa-edit&#x22;&#x3E;&#x3C;/i&#x3E;&#x3C;/button&#x3E;
          &#x3C;button class=&#x22;text-danger delete-logistics&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;i class=&#x22;fa fa-trash&#x22;&#x3E;&#x3C;/i&#x3E;&#x3C;/button&#x3E;
        &#x3C;/td&#x3E;
      &#x3C;/tr&#x3E;
    &#x60;;
  });
  tableBody.innerHTML = html;
  
  setTimeout(updateLogisticsCountryFilter, 0);
}

function updateLogisticsCountryFilter() {
  const filter = document.getElementById(&#x27;logistics-country-filter&#x27;);
  const countries = [...new Set(appState.logistics.map(item =&#x3E; item.country))];
  const currentVal = filter.value;
  
  // &#x4F18;&#x5316;&#x4E0B;&#x62C9;&#x6846;&#x751F;&#x6210;&#xFF0C;&#x51CF;&#x5C11;DOM&#x64CD;&#x4F5C;
  let options = &#x27;&#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x56FD;&#x5BB6;&#x3C;/option&#x3E;&#x27;;
  countries.forEach(country =&#x3E; {
    options += &#x60;&#x3C;option value=&#x22;${country}&#x22; ${country === currentVal ? &#x27;selected&#x27; : &#x27;&#x27;}&#x3E;${country}&#x3C;/option&#x3E;&#x60;;
  });
  filter.innerHTML = options;
}

// &#x4F63;&#x91D1;&#x8868;&#x683C;&#x6E32;&#x67D3;&#xFF08;&#x540C;&#x7269;&#x6D41;&#x8868;&#x683C;&#x4F18;&#x5316;&#x903B;&#x8F91;&#xFF09;
function renderCommissionTable() {
  const tableBody = document.getElementById(&#x27;commission-table-body&#x27;);
  const searchVal = document.getElementById(&#x27;commission-search&#x27;).value.toLowerCase();
  
  const filtered = appState.commissions.filter(item =&#x3E; 
    item.country.toLowerCase().includes(searchVal)
  );
  
  if (filtered.length === 0) {
    tableBody.innerHTML = &#x27;&#x3C;tr&#x3E;&#x3C;td colspan=&#x22;6&#x22; class=&#x22;px-2 py-4 text-center text-gray-500&#x22;&#x3E;&#x6682;&#x65E0;&#x4F63;&#x91D1;&#x6570;&#x636E;&#x3C;/td&#x3E;&#x3C;/tr&#x3E;&#x27;;
    return;
  }
  
  let html = &#x27;&#x27;;
  filtered.forEach(item =&#x3E; {
    html += &#x60;
      &#x3C;tr class=&#x22;border-b border-gray-100 hover:bg-gray-50&#x22;&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;&#x3C;input type=&#x22;checkbox&#x22; class=&#x22;commission-checkbox&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${item.country}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${Math.round(item.commission)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${Math.round(item.marketTax)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;${item.exchangeRate.toFixed(2)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-2 py-2&#x22;&#x3E;
          &#x3C;button class=&#x22;text-primary mr-2 edit-commission&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;i class=&#x22;fa fa-edit&#x22;&#x3E;&#x3C;/i&#x3E;&#x3C;/button&#x3E;
          &#x3C;button class=&#x22;text-danger delete-commission&#x22; data-id=&#x22;${item.id}&#x22;&#x3E;&#x3C;i class=&#x22;fa fa-trash&#x22;&#x3E;&#x3C;/i&#x3E;&#x3C;/button&#x3E;
        &#x3C;/td&#x3E;
      &#x3C;/tr&#x3E;
    &#x60;;
  });
  tableBody.innerHTML = html;
}

// &#x5DF2;&#x9009;&#x56FD;&#x5BB6;&#x6E32;&#x67D3;&#xFF08;&#x4F18;&#x5316;DOM&#x64CD;&#x4F5C;&#xFF09;
function renderSelectedShippingCountries() {
  const container = document.getElementById(&#x27;selected-shipping-countries&#x27;);
  let html = &#x27;&#x27;;
  appState.selectedShippingCountries.forEach((country, index) =&#x3E; {
    html += &#x60;
      &#x3C;div class=&#x22;tag-pill&#x22;&#x3E;
        ${country}
        &#x3C;button class=&#x22;ml-1 delete-shipping-country&#x22; data-index=&#x22;${index}&#x22;&#x3E;
          &#x3C;i class=&#x22;fa fa-times-circle&#x22;&#x3E;&#x3C;/i&#x3E;
        &#x3C;/button&#x3E;
      &#x3C;/div&#x3E;
    &#x60;;
  });
  container.innerHTML = html;
}
function renderSelectedPricingCountries() {
  const container = document.getElementById(&#x27;selected-pricing-countries&#x27;);
  let html = &#x27;&#x27;;
  appState.selectedPricingCountries.forEach((country, index) =&#x3E; {
    html += &#x60;
      &#x3C;div class=&#x22;tag-pill&#x22;&#x3E;
        ${country}
        &#x3C;button class=&#x22;ml-1 delete-pricing-country&#x22; data-index=&#x22;${index}&#x22;&#x3E;
          &#x3C;i class=&#x22;fa fa-times-circle&#x22;&#x3E;&#x3C;/i&#x3E;
        &#x3C;/button&#x3E;
      &#x3C;/div&#x3E;
    &#x60;;
  });
  container.innerHTML = html;
}

// &#x8FD0;&#x8D39;&#x7ED3;&#x679C;&#x6E32;&#x67D3;&#xFF08;&#x4F18;&#x5316;&#x5927;&#x6570;&#x636E;&#x91CF;&#x5C55;&#x793A;&#xFF09;
function renderShippingResult(results) {
  appState.shippingResults = results;
  const emptyState = document.getElementById(&#x27;shipping-result-empty&#x27;);
  const resultContainer = document.getElementById(&#x27;shipping-result&#x27;);
  const resultBody = document.getElementById(&#x27;shipping-result-body&#x27;);
  
  if (results.length === 0) {
    emptyState.classList.remove(&#x27;hidden&#x27;);
    resultContainer.classList.add(&#x27;hidden&#x27;);
    return;
  }
  
  emptyState.classList.add(&#x27;hidden&#x27;);
  resultContainer.classList.remove(&#x27;hidden&#x27;);
  
  // &#x4F18;&#x5316;&#x7B5B;&#x9009;&#x4E0B;&#x62C9;&#x6846;&#x751F;&#x6210;
  const countryFilter = document.getElementById(&#x27;result-country-filter&#x27;);
  const channelFilter = document.getElementById(&#x27;result-channel-filter&#x27;);
  const countries = [...new Set(results.map(r =&#x3E; r.country))];
  const channels = [...new Set(results.map(r =&#x3E; r.channel))];
  
  let countryOptions = &#x27;&#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x56FD;&#x5BB6;&#x3C;/option&#x3E;&#x27;;
  countries.forEach(country =&#x3E; {
    countryOptions += &#x60;&#x3C;option value=&#x22;${country}&#x22;&#x3E;${country}&#x3C;/option&#x3E;&#x60;;
  });
  countryFilter.innerHTML = countryOptions;
  
  let channelOptions = &#x27;&#x3C;option value=&#x22;&#x22;&#x3E;&#x6240;&#x6709;&#x6E20;&#x9053;&#x3C;/option&#x3E;&#x27;;
  channels.forEach(channel =&#x3E; {
    channelOptions += &#x60;&#x3C;option value=&#x22;${channel}&#x22;&#x3E;${channel}&#x3C;/option&#x3E;&#x60;;
  });
  channelFilter.innerHTML = channelOptions;
  
  // &#x4F18;&#x5316;&#x7ED3;&#x679C;&#x8868;&#x683C;&#x751F;&#x6210;&#xFF08;&#x5206;&#x6279;&#x6B21;&#x6E32;&#x67D3;&#xFF0C;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x5927;&#x6570;&#x636E;&#x91CF;&#x5361;&#x987F;&#xFF09;
  let html = &#x27;&#x27;;
  results.forEach(result =&#x3E; {
    const minBadge = result.isMinFreight ? 
      &#x27;&#x3C;span class=&#x22;bg-success/10 text-success text-xs px-2 py-0.5 rounded-full&#x22;&#x3E;&#x6700;&#x4F4E;&#x8FD0;&#x8D39;&#x3C;/span&#x3E;&#x27; : &#x27;&#x27;;
    
    html += &#x60;
      &#x3C;tr class=&#x22;border-b border-gray-100 hover:bg-gray-50&#x22;&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${result.country}&#x22;&#x3E;${result.country}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${result.channel}&#x22;&#x3E;${result.channel}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${result.volumeWeight.toFixed(3)}&#x22;&#x3E;${result.volumeWeight.toFixed(3)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${result.chargeableWeight.toFixed(3)}&#x22;&#x3E;${result.chargeableWeight.toFixed(3)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 font-medium ${result.isMinFreight ? &#x27;text-success&#x27; : &#x27;text-primary&#x27;} copy-hover&#x22; data-copy=&#x22;${result.freight.toFixed(2)}&#x22;&#x3E;${result.freight.toFixed(2)}&#x3C;/td&#x3E;
        &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${minBadge ? &#x27;&#x6700;&#x4F4E;&#x8FD0;&#x8D39;&#x27; : &#x27;&#x27;}&#x22;&#x3E;${minBadge}&#x3C;/td&#x3E;
      &#x3C;/tr&#x3E;
    &#x60;;
  });
  
  // &#x4F18;&#x5316;DOM&#x66F4;&#x65B0;&#x65F6;&#x673A;
  setTimeout(() =&#x3E; {
    resultBody.innerHTML = html;
    applyShippingFilters();
  }, 0);
}

// &#x8FD0;&#x8D39;&#x7ED3;&#x679C;&#x7B5B;&#x9009;&#xFF08;&#x7B80;&#x5316;&#x903B;&#x8F91;&#xFF0C;&#x51CF;&#x5C11;&#x8BA1;&#x7B97;&#xFF09;
function applyShippingFilters() {
  const country = document.getElementById(&#x27;result-country-filter&#x27;).value;
  const channel = document.getElementById(&#x27;result-channel-filter&#x27;).value;
  
  // &#x4F18;&#x5316;&#x7B5B;&#x9009;&#x903B;&#x8F91;&#xFF0C;&#x907F;&#x514D;&#x53CC;&#x91CD;&#x5FAA;&#x73AF;
  const rows = document.getElementById(&#x27;shipping-result-body&#x27;).querySelectorAll(&#x27;tr&#x27;);
  rows.forEach((row, index) =&#x3E; {
    const result = appState.shippingResults[index];
    const matchCountry = !country || result.country === country;
    const matchChannel = !channel || result.channel === channel;
    row.style.display = matchCountry &#x26;&#x26; matchChannel ? &#x27;&#x27; : &#x27;none&#x27;;
  });
}

// &#x552E;&#x4EF7;&#x7ED3;&#x679C;&#x6E32;&#x67D3;&#xFF08;&#x540C;&#x8FD0;&#x8D39;&#x7ED3;&#x679C;&#x4F18;&#x5316;&#x903B;&#x8F91;&#xFF09;
function renderPricingResult(results) {
  appState.pricingResults = results;
  const emptyState = document.getElementById(&#x27;pricing-result-empty&#x27;);
  const resultContainer = document.getElementById(&#x27;pricing-result&#x27;);
  const resultContent = document.getElementById(&#x27;pricing-result-container&#x27;);
  
  if (Object.keys(results).length === 0) {
    emptyState.classList.remove(&#x27;hidden&#x27;);
    resultContainer.classList.add(&#x27;hidden&#x27;);
    return;
  }
  
  emptyState.classList.add(&#x27;hidden&#x27;);
  resultContainer.classList.remove(&#x27;hidden&#x27;);
  
  // &#x4F18;&#x5316;&#x7ED3;&#x679C;&#x751F;&#x6210;&#xFF0C;&#x51CF;&#x5C11;DOM&#x64CD;&#x4F5C;
  let html = &#x27;&#x27;;
  for (const country in results) {
    const countryData = results[country];
    if (countryData.length === 0) continue;
    
    // &#x6536;&#x96C6;&#x552E;&#x4EF7;&#x7528;&#x4E8E;&#x590D;&#x5236;&#xFF08;&#x4F18;&#x5316;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#xFF09;
    const allPrices = countryData.map(pkg =&#x3E; &#x60;${pkg.price.toFixed(2)}&#x60;).join(&#x27;\n&#x27;);
    
    // &#x751F;&#x6210;&#x56FD;&#x5BB6;&#x5361;&#x7247;HTML
    html += &#x60;
      &#x3C;div class=&#x22;bg-white border border-gray-200 rounded-lg p-4 fade-in&#x22;&#x3E;
        &#x3C;div class=&#x22;flex justify-between items-center mb-4&#x22;&#x3E;
          &#x3C;h3 class=&#x22;font-semibold text-primary text-lg&#x22;&#x3E;${country}&#x3C;/h3&#x3E;
          &#x3C;button class=&#x22;btn-secondary text-sm flex items-center copy-all-prices&#x22; data-prices=&#x22;${allPrices}&#x22;&#x3E;
            &#x3C;i class=&#x22;fa fa-copy mr-1&#x22;&#x3E;&#x3C;/i&#x3E; &#x590D;&#x5236;&#x6240;&#x6709;&#x552E;&#x4EF7;
          &#x3C;/button&#x3E;
        &#x3C;/div&#x3E;
        &#x3C;table class=&#x22;min-w-full text-sm&#x22;&#x3E;
          &#x3C;thead&#x3E;
            &#x3C;tr class=&#x22;bg-gray-50 text-left&#x22;&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x5305;&#x88F9;&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x7269;&#x6D41;&#x6E20;&#x9053;&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x8BA1;&#x8D39;&#x91CD;&#x91CF; (kg)&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x8FD0;&#x8D39; (RMB)&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x91C7;&#x8D2D;&#x6210;&#x672C;(RMB)&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x5229;&#x6DA6;&#xFF08;RMB&#xFF09;&#x3C;/th&#x3E;
              &#x3C;th class=&#x22;px-4 py-3 font-medium text-gray-600&#x22;&#x3E;&#x552E;&#x4EF7; (&#x5F53;&#x5730;&#x8D27;&#x5E01;)&#x3C;/th&#x3E;
            &#x3C;/tr&#x3E;
          &#x3C;/thead&#x3E;
          &#x3C;tbody&#x3E;
    &#x60;;
    
    // &#x751F;&#x6210;&#x8868;&#x683C;&#x5185;&#x5BB9;
    countryData.forEach((pkg, idx) =&#x3E; {
      html += &#x60;
        &#x3C;tr class=&#x22;border-b border-gray-100 hover:bg-gray-50&#x22;&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;&#x5305;&#x88F9; ${idx + 1}&#x22;&#x3E;&#x5305;&#x88F9; ${idx + 1}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${pkg.channel}&#x22;&#x3E;${pkg.channel}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${pkg.chargeableWeight.toFixed(3)}&#x22;&#x3E;${pkg.chargeableWeight.toFixed(3)}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${pkg.freight.toFixed(2)}&#x22;&#x3E;${pkg.freight.toFixed(2)}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 copy-hover&#x22; data-copy=&#x22;${pkg.cost.toFixed(2)}&#x22;&#x3E;${pkg.cost.toFixed(2)}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 font-medium text-success copy-hover&#x22; data-copy=&#x22;${pkg.profit.toFixed(2)}&#x22;&#x3E;${pkg.profit.toFixed(2)}&#x3C;/td&#x3E;
          &#x3C;td class=&#x22;px-4 py-3 font-medium text-primary copy-hover&#x22; data-copy=&#x22;${pkg.price.toFixed(2)}&#x22;&#x3E;${pkg.price.toFixed(2)}&#x3C;/td&#x3E;
        &#x3C;/tr&#x3E;
      &#x60;;
    });
    
    html += &#x60;
          &#x3C;/tbody&#x3E;
        &#x3C;/table&#x3E;
      &#x3C;/div&#x3E;
    &#x60;;
  }
  
  // &#x5EF6;&#x8FDF;&#x66F4;&#x65B0;DOM&#xFF0C;&#x907F;&#x514D;&#x4E3B;&#x7EBF;&#x7A0B;&#x963B;&#x585E;
  setTimeout(() =&#x3E; {
    resultContent.innerHTML = html;
  }, 0);
}

// &#x8BA1;&#x7B97;&#x903B;&#x8F91;&#xFF08;&#x4F18;&#x5316;&#x6027;&#x80FD;&#xFF0C;&#x51CF;&#x5C11;&#x90E8;&#x7F72;&#x540E;&#x8BA1;&#x7B97;&#x8017;&#x65F6;&#xFF09;
function calculateShipping(formData) {
  try {
    const entries = Object.fromEntries(formData.entries());
    const { length, width, height, volumeParam, weight } = entries;
    const selectedCountries = appState.selectedShippingCountries;
    
    // &#x57FA;&#x7840;&#x9A8C;&#x8BC1;&#xFF08;&#x63D0;&#x524D;&#x8FD4;&#x56DE;&#xFF0C;&#x907F;&#x514D;&#x65E0;&#x6548;&#x8BA1;&#x7B97;&#xFF09;
    if (selectedCountries.length === 0) return [];
    
    // &#x6570;&#x503C;&#x9A8C;&#x8BC1;&#xFF08;&#x7B80;&#x5316;&#x903B;&#x8F91;&#xFF0C;&#x51CF;&#x5C11;&#x5224;&#x65AD;&#xFF09;
    const params = {
      length: parseFloat(length),
      width: parseFloat(width),
      height: parseFloat(height),
      volumeParam: parseFloat(volumeParam),
      weight: parseFloat(weight)
    };
    for (const val of Object.values(params)) {
      if (isNaN(val) || val &#x3C;= 0) return [];
    }
    
    // &#x6838;&#x5FC3;&#x8BA1;&#x7B97;&#xFF08;&#x7B80;&#x5316;&#x516C;&#x5F0F;&#xFF0C;&#x51CF;&#x5C11;&#x8FD0;&#x7B97;&#xFF09;
    const volumeWeight = (params.length * params.width * params.height) / params.volumeParam;
    const chargeableWeight = Math.max(volumeWeight, params.weight);
    const countryResults = {};
    let maxResultCount = 0;
    
    // &#x7269;&#x6D41;&#x7B5B;&#x9009;&#xFF08;&#x4F18;&#x5316;&#x5FAA;&#x73AF;&#xFF0C;&#x51CF;&#x5C11;&#x5197;&#x4F59;&#x8BA1;&#x7B97;&#xFF09;
    selectedCountries.forEach(country =&#x3E; {
      const eligibleLogistics = appState.logistics.filter(item =&#x3E; 
        item.country === country &#x26;&#x26; 
        chargeableWeight &#x3E;= item.startWeight &#x26;&#x26; 
        chargeableWeight &#x3C;= item.endWeight
      );
      
      if (eligibleLogistics.length === 0) return;
      
      // &#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#xFF08;&#x7B80;&#x5316;&#x6392;&#x5E8F;&#xFF0C;&#x51CF;&#x5C11;&#x6BD4;&#x8F83;&#x6B21;&#x6570;&#xFF09;
      const sortedResults = eligibleLogistics.map(item =&#x3E; ({
        country: item.country,
        channel: item.channel,
        volumeWeight,
        chargeableWeight,
        freight: chargeableWeight * item.costPerKg + item.registrationFee,
        isMinFreight: false
      })).sort((a, b) =&#x3E; a.freight - b.freight);
      
      if (sortedResults.length &#x3E; 0) sortedResults[0].isMinFreight = true;
      countryResults[country] = sortedResults;
      maxResultCount = Math.max(maxResultCount, sortedResults.length);
    });
    
    // &#x7ED3;&#x679C;&#x7EC4;&#x7EC7;&#xFF08;&#x4F18;&#x5316;&#x903B;&#x8F91;&#xFF0C;&#x51CF;&#x5C11;&#x5FAA;&#x73AF;&#x5D4C;&#x5957;&#xFF09;
    const finalResults = [];
    const countryOrder = selectedCountries;
    
    if (countryOrder.length === 1) {
      const singleCountry = countryOrder[0];
      if (countryResults[singleCountry]) finalResults.push(...countryResults[singleCountry]);
    } else {
      for (let round = 0; round &#x3C; maxResultCount; round++) {
        countryOrder.forEach(country =&#x3E; {
          const countryData = countryResults[country];
          if (countryData &#x26;&#x26; countryData[round]) finalResults.push(countryData[round]);
        });
      }
    }
    
    return finalResults;
  } catch (e) {
    console.error(&#x27;&#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#x9519;&#x8BEF;:&#x27;, e);
    return [];
  }
}

// &#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#x903B;&#x8F91;&#xFF08;&#x540C;&#x8FD0;&#x8D39;&#x8BA1;&#x7B97;&#x4F18;&#x5316;&#xFF09;
function calculatePricing() {
  try {
    const countries = appState.selectedPricingCountries;
    const packageForms = document.querySelectorAll(&#x27;.package-form&#x27;);
    const results = {};
    const customShippingFee = parseFloat(document.getElementById(&#x27;custom-shipping-fee&#x27;).value) || 0;
    
    if (countries.length === 0 || packageForms.length === 0) return {};
    
    // &#x4F18;&#x5316;&#x5FAA;&#x73AF;&#x5D4C;&#x5957;&#xFF0C;&#x51CF;&#x5C11;&#x8BA1;&#x7B97;&#x6DF1;&#x5EA6;
    countries.forEach(country =&#x3E; {
      const commissionInfo = appState.commissions.find(item =&#x3E; item.country === country);
      if (!commissionInfo) return;
      
      const packageResults = [];
      packageForms.forEach((form, formIdx) =&#x3E; {
        // &#x5FEB;&#x901F;&#x83B7;&#x53D6;&#x8868;&#x5355;&#x6570;&#x636E;&#xFF0C;&#x51CF;&#x5C11;DOM&#x67E5;&#x8BE2;
        const length = parseFloat(form.querySelector(&#x27;input[name=&#x22;length&#x22;]&#x27;).value);
        const width = parseFloat(form.querySelector(&#x27;input[name=&#x22;width&#x22;]&#x27;).value);
        const height = parseFloat(form.querySelector(&#x27;input[name=&#x22;height&#x22;]&#x27;).value);
        const weight = parseFloat(form.querySelector(&#x27;input[name=&#x22;weight&#x22;]&#x27;).value);
        const cost = parseFloat(form.querySelector(&#x27;input[name=&#x22;cost&#x22;]&#x27;).value);
        const profitMargin = parseFloat(form.querySelector(&#x27;input[name=&#x22;profitMargin&#x22;]&#x27;).value);
        
        if (isNaN(length) || isNaN(width) || isNaN(height) || isNaN(weight) || isNaN(cost) || isNaN(profitMargin)) {
          return;
        }
        
        // &#x6838;&#x5FC3;&#x8BA1;&#x7B97;&#xFF08;&#x7B80;&#x5316;&#x516C;&#x5F0F;&#xFF09;
        const volumeWeight = (length * width * height) / 8000;
        const chargeableWeight = Math.max(volumeWeight, weight);
        
        let minFreight, bestChannel;
        if (customShippingFee &#x3E; 0) {
          minFreight = customShippingFee;
          bestChannel = &#x22;&#x81EA;&#x5B9A;&#x4E49;&#x22;;
        } else {
          const eligibleLogistics = appState.logistics.filter(item =&#x3E; 
            item.country === country &#x26;&#x26; 
            chargeableWeight &#x3E;= item.startWeight &#x26;&#x26; 
            chargeableWeight &#x3C;= item.endWeight
          );
          
          if (eligibleLogistics.length === 0) return;
          
          minFreight = Infinity;
          bestChannel = &#x27;&#x27;;
          eligibleLogistics.forEach(item =&#x3E; {
            const freight = chargeableWeight * item.costPerKg + item.registrationFee;
            if (freight &#x3C; minFreight) {
              minFreight = freight;
              bestChannel = item.channel;
            }
          });
        }
        
        // &#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#xFF08;&#x4F18;&#x5316;&#x516C;&#x5F0F;&#xFF0C;&#x51CF;&#x5C11;&#x9664;&#x6CD5;&#x8FD0;&#x7B97;&#xFF09;
        const { commission, marketTax, exchangeRate } = commissionInfo;
        const commissionRate = commission / 100;
        const taxRate = marketTax / 100;
        const profitRate = profitMargin / 100;
        
        let price = (cost + minFreight) / ((1 - commissionRate - taxRate) * (1 - profitRate) * exchangeRate);
        
        // &#x7279;&#x6B8A;&#x56FD;&#x5BB6;&#x5904;&#x7406;&#xFF08;&#x7B80;&#x5316;&#x5224;&#x65AD;&#xFF09;
        if ((isGbpCountry(country) || isEurCountry(country)) &#x26;&#x26; price &#x3E; 150) {
          price = (cost + minFreight) / ((1 - commissionRate) * (1 - profitRate) * exchangeRate);
        }
        
        // &#x5229;&#x6DA6;&#x8BA1;&#x7B97;&#xFF08;&#x7B80;&#x5316;&#x516C;&#x5F0F;&#xFF09;
        const profit = price * exchangeRate - cost - minFreight;
        
        packageResults.push({
          packageIndex: formIdx + 1,
          channel: bestChannel,
          volumeWeight,
          chargeableWeight,
          freight: minFreight,
          cost: cost,
          price,
          profit
        });
      });
      
      if (packageResults.length &#x3E; 0) results[country] = packageResults;
    });
    
    return results;
  } catch (e) {
    console.error(&#x27;&#x552E;&#x4EF7;&#x8BA1;&#x7B97;&#x9519;&#x8BEF;:&#x27;, e);
    return {};
  }
}

// &#x6A21;&#x5757;&#x5207;&#x6362;&#xFF08;&#x4F18;&#x5316;DOM&#x64CD;&#x4F5C;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x7ED8;&#xFF09;
function switchToShippingModule() {
  requestAnimationFrame(() =&#x3E; {
    document.getElementById(&#x27;shipping-module&#x27;).classList.remove(&#x27;module-hidden&#x27;);
    document.getElementById(&#x27;pricing-module&#x27;).classList.add(&#x27;module-hidden&#x27;);
    
    // &#x4F18;&#x5316;&#x6807;&#x7B7E;&#x72B6;&#x6001;&#x5207;&#x6362;&#xFF0C;&#x51CF;&#x5C11;DOM&#x64CD;&#x4F5C;
    const tabShipping = document.getElementById(&#x27;tab-shipping&#x27;);
    const tabPricing = document.getElementById(&#x27;tab-pricing&#x27;);
    tabShipping.classList.add(&#x27;text-primary&#x27;, &#x27;border-b-2&#x27;, &#x27;border-primary&#x27;);
    tabShipping.classList.remove(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    tabPricing.classList.remove(&#x27;text-primary&#x27;, &#x27;border-b-2&#x27;, &#x27;border-primary&#x27;);
    tabPricing.classList.add(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    
    // &#x79FB;&#x52A8;&#x7AEF;&#x6807;&#x7B7E;
    const mobileTabShipping = document.getElementById(&#x27;mobile-tab-shipping&#x27;);
    const mobileTabPricing = document.getElementById(&#x27;mobile-tab-pricing&#x27;);
    mobileTabShipping.classList.add(&#x27;text-primary&#x27;, &#x27;border-l-4&#x27;, &#x27;border-primary&#x27;);
    mobileTabShipping.classList.remove(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    mobileTabPricing.classList.remove(&#x27;text-primary&#x27;, &#x27;border-l-4&#x27;, &#x27;border-primary&#x27;);
    mobileTabPricing.classList.add(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    
    document.getElementById(&#x27;mobile-menu&#x27;).classList.add(&#x27;hidden&#x27;);
  });
}
function switchToPricingModule() {
  requestAnimationFrame(() =&#x3E; {
    document.getElementById(&#x27;shipping-module&#x27;).classList.add(&#x27;module-hidden&#x27;);
    document.getElementById(&#x27;pricing-module&#x27;).classList.remove(&#x27;module-hidden&#x27;);
    
    const tabPricing = document.getElementById(&#x27;tab-pricing&#x27;);
    const tabShipping = document.getElementById(&#x27;tab-shipping&#x27;);
    tabPricing.classList.add(&#x27;text-primary&#x27;, &#x27;border-b-2&#x27;, &#x27;border-primary&#x27;);
    tabPricing.classList.remove(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    tabShipping.classList.remove(&#x27;text-primary&#x27;, &#x27;border-b-2&#x27;, &#x27;border-primary&#x27;);
    tabShipping.classList.add(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    
    const mobileTabPricing = document.getElementById(&#x27;mobile-tab-pricing&#x27;);
    const mobileTabShipping = document.getElementById(&#x27;mobile-tab-shipping&#x27;);
    mobileTabPricing.classList.add(&#x27;text-primary&#x27;, &#x27;border-l-4&#x27;, &#x27;border-primary&#x27;);
    mobileTabPricing.classList.remove(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    mobileTabShipping.classList.remove(&#x27;text-primary&#x27;, &#x27;border-l-4&#x27;, &#x27;border-primary&#x27;);
    mobileTabShipping.classList.add(&#x27;text-gray-600&#x27;, &#x27;border-transparent&#x27;);
    
    document.getElementById(&#x27;mobile-menu&#x27;).classList.add(&#x27;hidden&#x27;);
  });
}

// &#x3010;&#x6838;&#x5FC3;&#x4F18;&#x5316;&#x3011;Excel&#x5BFC;&#x5165;&#x5904;&#x7406;&#xFF08;&#x9488;&#x5BF9;&#x9759;&#x6001;&#x7AD9;&#x70B9;&#x90E8;&#x7F72;&#xFF09;
function processExcelImport(file, importType, onProgress, onComplete, onError) {
  // 1. &#x5F3A;&#x5316;&#x6587;&#x4EF6;&#x9A8C;&#x8BC1;&#xFF08;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x63D0;&#x524D;&#x62E6;&#x622A;&#x65E0;&#x6548;&#x6587;&#x4EF6;&#xFF09;
  const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
  if (file.size &#x3E; MAX_FILE_SIZE) {
    onError(&#x27;&#x6587;&#x4EF6;&#x8FC7;&#x5927;&#xFF08;&#x6700;&#x5927;10MB&#xFF09;&#xFF0C;&#x8BF7;&#x538B;&#x7F29;&#x540E;&#x91CD;&#x8BD5;&#x27;);
    return;
  }
  if (!file.name.endsWith(&#x27;.xls&#x27;) &#x26;&#x26; !file.name.endsWith(&#x27;.xlsx&#x27;)) {
    onError(&#x27;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x9519;&#x8BEF;&#xFF0C;&#x4EC5;&#x652F;&#x6301;xls/xlsx&#x27;);
    return;
  }
  
  // 2. &#x4F18;&#x5316;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#xFF08;&#x4F7F;&#x7528;Web Workers&#x907F;&#x514D;&#x4E3B;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x5173;&#x952E;&#x4F18;&#x5316;&#xFF09;
  let worker;
  try {
    // &#x52A8;&#x6001;&#x521B;&#x5EFA;Worker&#xFF08;&#x907F;&#x514D;&#x5916;&#x90E8;&#x6587;&#x4EF6;&#x4F9D;&#x8D56;&#xFF09;
    const workerScript = &#x60;
      importScripts(&#x27;https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js&#x27;);
      
      self.onmessage = function(e) {
        try {
          const { fileData, importType } = e.data;
          const data = new Uint8Array(fileData);
          
          // &#x5206;&#x6B65;&#x53D1;&#x9001;&#x8FDB;&#x5EA6;&#xFF08;&#x907F;&#x514D;&#x90E8;&#x7F72;&#x540E;&#x8FDB;&#x5EA6;&#x4E0D;&#x66F4;&#x65B0;&#xFF09;
          self.postMessage({ type: &#x27;progress&#x27;, value: 20 });
          
          // &#x4F18;&#x5316;Excel&#x89E3;&#x6790;&#xFF08;&#x7981;&#x7528;&#x6837;&#x5F0F;&#x89E3;&#x6790;&#xFF0C;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x5360;&#x7528;&#xFF09;
          const workbook = XLSX.read(data, { 
            type: &#x27;array&#x27;,
            cellStyles: false, // &#x7981;&#x7528;&#x5355;&#x5143;&#x683C;&#x6837;&#x5F0F;&#x89E3;&#x6790;
            cellHTML: false,  // &#x7981;&#x7528;HTML&#x89E3;&#x6790;
            sheets: undefined // &#x53EA;&#x89E3;&#x6790;&#x7B2C;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x8868;
          });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          
          self.postMessage({ type: &#x27;progress&#x27;, value: 40 });
          
          // &#x4F18;&#x5316;JSON&#x8F6C;&#x6362;&#xFF08;&#x4EC5;&#x4FDD;&#x7559;&#x9700;&#x8981;&#x7684;&#x5B57;&#x6BB5;&#xFF09;
          const jsonData = XLSX.utils.sheet_to_json(worksheet, {
            header: 1, // &#x5148;&#x6309;&#x6570;&#x7EC4;&#x8BFB;&#x53D6;&#xFF0C;&#x51CF;&#x5C11;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;
            raw: true  // &#x4FDD;&#x7559;&#x539F;&#x59CB;&#x503C;&#xFF0C;&#x907F;&#x514D;&#x7C7B;&#x578B;&#x8F6C;&#x6362;
          });
          
          // &#x79FB;&#x9664;&#x8868;&#x5934;&#xFF08;&#x7B2C;&#x4E00;&#x884C;&#xFF09;
          const header = jsonData.shift();
          
          // &#x5904;&#x7406;&#x6570;&#x636E;&#xFF08;&#x6309;&#x7C7B;&#x578B;&#x7B5B;&#x9009;&#x9700;&#x8981;&#x7684;&#x5B57;&#x6BB5;&#xFF09;
          let processedData = [];
          if (importType === &#x27;logistics&#x27;) {
            // &#x7269;&#x6D41;&#x6570;&#x636E;&#xFF1A;&#x53EA;&#x4FDD;&#x7559;&#x9700;&#x8981;&#x7684;&#x5217;
            const countryIdx = header.indexOf(&#x27;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x27;) !== -1 ? header.indexOf(&#x27;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x27;) : header.indexOf(&#x27;country&#x27;);
            const channelIdx = header.indexOf(&#x27;&#x7269;&#x6D41;&#x6E20;&#x9053;&#x27;) !== -1 ? header.indexOf(&#x27;&#x7269;&#x6D41;&#x6E20;&#x9053;&#x27;) : header.indexOf(&#x27;channel&#x27;);
            const startWeightIdx = header.indexOf(&#x27;&#x8D77;&#x59CB;&#x91CD;&#x91CF;(kg)&#x27;) !== -1 ? header.indexOf(&#x27;&#x8D77;&#x59CB;&#x91CD;&#x91CF;(kg)&#x27;) : header.indexOf(&#x27;startWeight&#x27;);
            const endWeightIdx = header.indexOf(&#x27;&#x7ED3;&#x675F;&#x91CD;&#x91CF;(kg)&#x27;) !== -1 ? header.indexOf(&#x27;&#x7ED3;&#x675F;&#x91CD;&#x91CF;(kg)&#x27;) : header.indexOf(&#x27;endWeight&#x27;);
            const costPerKgIdx = header.indexOf(&#x27;&#x6BCF;kg&#x8D39;&#x7528;&#x27;) !== -1 ? header.indexOf(&#x27;&#x6BCF;kg&#x8D39;&#x7528;&#x27;) : header.indexOf(&#x27;costPerKg&#x27;);
            const registrationFeeIdx = header.indexOf(&#x27;&#x6302;&#x53F7;&#x8D39;&#x27;) !== -1 ? header.indexOf(&#x27;&#x6302;&#x53F7;&#x8D39;&#x27;) : header.indexOf(&#x27;registrationFee&#x27;);
            
            // &#x8FC7;&#x6EE4;&#x65E0;&#x6548;&#x6570;&#x636E;
            processedData = jsonData.filter(row =&#x3E; 
              row[countryIdx] &#x26;&#x26; row[channelIdx] &#x26;&#x26; !isNaN(parseFloat(row[startWeightIdx]))
            ).map(row =&#x3E; ({
              country: row[countryIdx] || &#x27;&#x27;,
              channel: row[channelIdx] || &#x27;&#x27;,
              startWeight: parseFloat(row[startWeightIdx]) || 0,
              endWeight: parseFloat(row[endWeightIdx]) || 0,
              costPerKg: parseFloat(row[costPerKgIdx]) || 0,
              registrationFee: parseFloat(row[registrationFeeIdx]) || 0
            }));
          } else if (importType === &#x27;commission&#x27;) {
            // &#x4F63;&#x91D1;&#x6570;&#x636E;&#xFF1A;&#x53EA;&#x4FDD;&#x7559;&#x9700;&#x8981;&#x7684;&#x5217;
            const countryIdx = header.indexOf(&#x27;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x27;) !== -1 ? header.indexOf(&#x27;&#x56FD;&#x5BB6;/&#x5730;&#x533A;&#x27;) : header.indexOf(&#x27;country&#x27;);
            const commissionIdx = header.indexOf(&#x27;&#x4F63;&#x91D1;(%)&#x27;) !== -1 ? header.indexOf(&#x27;&#x4F63;&#x91D1;(%)&#x27;) : header.indexOf(&#x27;commission&#x27;);
            const marketTaxIdx = header.indexOf(&#x27;&#x5E02;&#x573A;&#x7A0E;(%)&#x27;) !== -1 ? header.indexOf(&#x27;&#x5E02;&#x573A;&#x7A0E;(%)&#x27;) : header.indexOf(&#x27;marketTax&#x27;);
            const exchangeRateIdx = header.indexOf(&#x27;&#x6C47;&#x7387;&#x27;) !== -1 ? header.indexOf(&#x27;&#x6C47;&#x7387;&#x27;) : header.indexOf(&#x27;exchangeRate&#x27;);
            
            processedData = jsonData.filter(row =&#x3E; 
              row[countryIdx] &#x26;&#x26; !isNaN(parseFloat(row[commissionIdx])) &#x26;&#x26; !isNaN(parseFloat(row[marketTaxIdx]))
            ).map(row =&#x3E; ({
              country: row[countryIdx] || &#x27;&#x27;,
              commission: parseFloat(row[commissionIdx]) || 0,
              marketTax: parseFloat(row[marketTaxIdx]) || 0,
              exchangeRate: parseFloat(row[exchangeRateIdx]) || 0
            }));
          }
          
          self.postMessage({ type: &#x27;progress&#x27;, value: 60 });
          self.postMessage({ 
            type: &#x27;complete&#x27;, 
            data: processedData,
            importType: importType
          });
        } catch (error) {
